# 煎蛋网妹子图


***
## 分析煎蛋网
煎蛋网(http://jandan.net/ooxx)
* 原来的页面都是从一开始的，直接放到URL的尾部即可，煎蛋网的情况不一样，需要找到当前页面的标记
* 在每个页面的URL中找到每张图片的URL链接即可

***
## 基础知识
### OS
os.mkdir(path, mode=0o777, *, dir_fd=None)
```
path--要创建的目录
mode--要为目录设置的权限数字模式，默认的模式为0o777(八进制)
如果这个目录已经存在，产生FileExistsError异常
```
* Ex.1 在E:\目录下创建temp目录，也就是在E盘下创建一个temp文件夹，注意只能创建一个文件夹，前面的文件夹一定要存在
```python
import os
path="E:\\temp"
os.mkdir(path=path,mode=0o755)
print("目录已经创建！！！")
>>>目录已经创建！！！
```
os.rmdir(path, *, dir_fd=None)
* Ex.1 删除目录
```python
import os
path="E:\\temp"
os.rmdir(path=path)
print("目录已经删除！！！")
>>>目录已经删除！！！
```
os.chdir(path)
* Ex.1 改变当前工作目录，在创建新目录的时候，如果`path='Harrdy2018'`，表示在当前文件夹下创建目录；如果`path='/Harrdy2018'`，则在根目录下创建！！！
```python
import os
#查看当前工作目录
cwd=os.getcwd()
print("当前工作目录为：%s"% cwd)
#创建一个新目录
path='\\Harrdy2018'
os.mkdir(path=path,mode=0o777)
print('新目录已经创建！！！')
#修改当前工作目录
os.chdir(path=path)
#查看修改后的工作目录
cwd=os.getcwd()
print("当前工作目录为：%s"% cwd)
>>>当前工作目录为：E:\Kang Lu\PycharmProjects\网络编程
新目录已经创建！！！
当前工作目录为：E:\Harrdy2018
```

***
### 字符串的find方法
str.find(sub[, start[, end]])
```
在切片s[start:end]中查找子字符串，如果被找到，返回最小的索引值，反之返回-1。可选的参数start和end是切片的标记。
```
* Ex.1
```python
str1="Harrdy2018"
sub="dy"
print(str1.find(sub))
print(str1.find(sub,2))
print(str1.find(sub,5,-1))
>>>4
4
-1
```

## 实战
**First**
* 找到煎蛋网妹子图入口。煎蛋网-->妹子图，当我们点击妹子图的时候，我们实际上到达了妹子图的第一页，但是煎蛋网把这页面标记为下图的`84`,所以我们要找到这个标记
***
![煎蛋网妹子图入口](https://github.com/Harrdy2018/Python3-Crawl/blob/master/jiandanA.png)
***
** 首先检查服务器返回的一些信息
```python
import urllib.request
url="http://jandan.net/ooxx"
req=urllib.request.Request(url)
req.add_header('User-Agent','Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36')
response=urllib.request.urlopen(req)
print(response.getcode())
print(response.info())
print(response.geturl())
```
**在爬虫初级阶段我经常喜欢这样做，一是为了加强记忆，二是检查代码是否可行**
```
服务器状态码200
页面信息：
Server: marco/2.0
Date: Mon, 23 Apr 2018 02:01:58 GMT
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: close
Vary: Accept-Encoding
X-Source: C/200
Link: <http://jandan.net/wp-json/>; rel="https://api.w.org/"
Link: <http://jandan.net/?p=21183>; rel=shortlink
Cache-Control: max-age=300
Expires: Mon, 23 Apr 2018 02:07:02 GMT
Fcache: HIT
X-Powered-By: PHP/5.6.35
Accept-Ranges: bytes
Age: 48
X-Request-Id: 3b1b709670b57fe0903851996e750529
Via: S.mix-js-czx-102, T.101.H, V.mix-js-czx-101, T.17.M, M.ctn-ha-lya-017
请求的url:http://jandan.net/ooxx
```
** 写get_sign(url)函数，返回页面标记，为整形
```python
import urllib.request
def get_sign(url):
    req=urllib.request.Request(url)
    req.add_header('User-Agent','Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36')
    response=urllib.request.urlopen(req)
    html=response.read().decode('utf-8')
    a=html.find("current-comment-page")+23
    b=html.find(']',a)
    return int(html[a:b])
url="http://jandan.net/ooxx"
print(get_sign(url))
>>>84
```

***
